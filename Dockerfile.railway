FROM ghcr.io/postalserver/postal:latest

USER root

ENV RAILS_ENV=production
ENV BIND_ADDRESS=0.0.0.0
ENV PORT=8080
ENV POSTAL_CONFIG_ROOT=/app/config

RUN mkdir -p /app/config && chmod 755 /app/config

# Copiar script
COPY start-postal.sh /app/start-postal.sh
RUN chmod +x /app/start-postal.sh

# Crear enlace simb√≥lico para Railway
RUN ln -s /app/start-postal.sh /railway-entrypoint.sh

USER postal

EXPOSE 8080

ENTRYPOINT ["/app/start-postal.sh"]
